<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lanciare - Perfil e Configurações</title>
  <link rel="shortcut icon"
    href="https://res.cloudinary.com/dnet6nodm/image/upload/v1761875332/Users_photos/frijvnfjk7rlwtwxktd5.png"
    type="image/x-icon">
  <link rel="stylesheet" href="{{ url_for('static', filename='styles/StyleConfig.css') }}">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link rel="stylesheet" href="{{  url_for('static', filename='styles/components/header.css')  }}">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

</head>

<body class="d-flex flex-column min-vh-100">
  {% include 'components/Header.html' %}

  <main class="flex-fill">
    <div class="container settings-page-layout">
      <aside class="settings-sidebar">
        <div class="user-summary">
          <img src="{{photo}}" alt="User Avatar" class="avatar">
          <h3>{{name}}</h3>
          <p>@{{username}}</p>

          <form id="avatar-upload-form" action="/changePhoto" method="post" enctype="multipart/form-data">
            <div id="avatar-dropzone" class="dropzone">
              <p>Arraste uma imagem ou clique aqui</p>
              <input type="file" id="avatar-file" name="photo" accept="image/*" hidden>
            </div>
            <button type="submit" class="btn-primary" style="margin-top:10px;">Mudar Imagem</button>
          </form>
        </div>

        <nav class="settings-nav">
          <ul>
            <li class="nav-item active" data-section="profile"><a href="#"><i class="fas fa-user-cog"></i> Perfil e
                Dados</a></li>
            <li class="nav-item" data-section="contact"><a href="#"><i class="fas fa-phone"></i> Contato</a></li>
            <li class="nav-item" data-section="addresses"><a href="#"><i class="fas fa-map-marker-alt"></i>
                Endereços</a></li>
            <li class="nav-item"><a href="/userBidsPage"><i class="fas fa-gavel"></i> Meus Lances</a></li>
            <li class="nav-item" data-section="security"><a href="#"><i class="fas fa-lock"></i> Segurança</a></li>
            <li class="nav-item separator">
              <hr>
            </li>
            <li class="nav-item"><a href="{{url_for('logout.logout')}}"><i class="fas fa-sign-out-alt"></i> Sair da
                Conta</a></li>
          </ul>
        </nav>
      </aside>

      <section class="settings-content-area">

        <div id="profile" class="settings-section active-section">
          <h2>Configurações de Perfil</h2>
          <p class="section-description">Gerencie suas informações públicas e de contato.</p>
          <div class="settings-form-card">
            <form id="profile-form" action="/changeConfig" method="post" class="profile-form">
              {%if user_type=="physical_person"%}
              <div class="input-group">
                <label for="name">Nome Completo</label>
                <input type="text" id="name" value="{{name}}" name="name">
              </div>
              {%else%}
              {%if user_type=="legal_person"%}
              <div class="input-group">
                <label for="trade_name">Nome Fantasia</label>
                <input type="text" id="trade_name" value="{{trade_name}}" name="trade_name">
              </div>
              <div class="input-group">
                <label for="legal_business_name">Razão Social</label>
                <input type="text" id="legal_business_name" value="{{legal_business_name}}" name="legal_business_name">
              </div>
              {%endif%}
              {%endif%}

              <div class="input-group">
                <label for="username">Nome de Usuário</label>
                <input type="text" id="username" value="{{username}}" name="username">
              </div>

              <div class="input-group">
                <label for="email">Email</label>
                <p>{{email}}</p>
              </div>

              {%if cpf%}
              <div class="input-group">
                <label for="cpf">CPF</label>
                <p>{{cpf}}</p>
              </div>
              {%endif%}

              {%if user_type=="physical_person"%}
              {%if rg%}
              <div class="input-group">
                <label for="rg">Rg</label>
                <p>{{rg}}</p>
              </div>
              {%endif%}

              <div class="input-group">
                <label for="gender">Sexo</label>
                <select id="gender" name="gender">
                  <option value="{{gender}}">{{gender}}</option>
                  <option value="male" {% if gender=="male" %}selected{% endif %}>Masculino</option>
                  <option value="female" {% if gender=="female" %}selected{% endif %}>Feminino</option>
                  <option value="other" {% if gender=="other" %}selected{% endif %}>Outro</option>
                </select>
              </div>

              {%if not cpf or not rg%}
              <h2>Informações Faltantes</h2>
              {%endif%}
              {%if not cpf%}
              <div class="input-group">
                <label for="cpf">Adicionar CPF</label>
                <input type="text" id="cpf" value="{{cpf}}" name="cpf">
              </div>
              {%endif%}
              {%if not rg%}
              <div class="input-group">
                <label for="rg">Adicionar Rg</label>
                <input type="text" id="rg" value="{{rg}}" name="rg">
              </div>
              {%endif%}

              {%else%}
              {%if user_type=="legal_person"%}
              {%if cnpj%}
              <div class="input-group">
                <label for="cnpj">CNPJ</label>
                <p>{{cnpj}}</p>
              </div>
              {%endif%}
              {%if state_tax_registration%}
              <div class="input-group">
                <label for="state_tax_registration">Adicionar state_tax_registration</label>
                <p>{{state_tax_registration}}</p>
              </div>
              {%endif%}
              <h2>Informações Faltantes</h2>

              {%if not cnpj%}
              <div class="input-group">
                <label for="cnpj">Adicionar CNPJ</label>
                <input type="text" id="cnpj" value="{{cnpj}}" name="cnpj">
              </div>
              {%endif%}

              {%if not state_tax_registration%}
              <div class="input-group">
                <label for="state_tax_registration">Adicionar state_tax_registration</label>
                <input type="text" id="state_tax_registration" value="{{state_tax_registration}}"
                  name="state_tax_registration">
              </div>
              {%endif%}
              {%endif%}
              {%endif%}

              {% if msg and msg!="sucessful"%}
              <p>{{msg}}</p>
              {% endif %}

              <div class="form-actions profile-actions">
                <button type="submit" class="btn-primary">Salvar Alterações do Perfil</button>
                <button type="button" class="btn-secondary">Cancelar</button>
              </div>

            </form>
          </div>
        </div>

        <div id="contact" class="settings-section hidden-section">
          <h2>Contato</h2>
          <p class="section-description">Gerencie seus números de telefone e informações pessoais.</p>
          <div class="settings-form-card">
            <form id="contact-form" action="/changeContact" method="post" class="contact-form">
              <div class="input-group">
                <label for="cellphone1">Telefone Principal</label>
                <input type="text" id="cellphone1" name="cellphone1" placeholder="(00) 90000-0000"
                  value="{{cellphone1}}">
              </div>

              <div class="input-group">
                <label for="cellphone2">Telefone Secundário</label>
                <input type="text" id="cellphone2" name="cellphone2" placeholder="(00) 90000-0000"
                  value="{{cellphone2}}">
              </div>

              <div class="input-group">
                <label for="landline">Telefone Fixo</label>
                <input type="text" id="landline" name="landline" placeholder="(00) 0000-0000" value="{{landline}}">
              </div>

              <div class="form-actions">
                <button type="submit" class="btn-primary">Salvar Contato</button>
                <button type="button" class="btn-secondary">Cancelar</button>
              </div>
            </form>
          </div>
        </div>

        <div id="addresses" class="settings-section hidden-section">
          <h2>Endereços</h2>
          <p class="section-description">Gerencie seus endereços de entrega e cobrança.</p>

          <div class="settings-form-card">
            <h3>Adicionar Novo Endereço</h3>
            <form id="new-address-form" class="address-form">

              <div class="input-row">
                <div class="input-group">
                  <label for="street_name">Rua</label>
                  <input type="text" name="street_name" id="street_name" required
                    placeholder="Digite a rua (sem abreviações)">
                </div>
                <div class="input-group">
                  <label for="street_number">Número</label>
                  <input type="text" name="street_number" id="street_number" required placeholder="Digite o número">
                </div>
              </div>

              <div class="input-row">
                <div class="input-group">
                  <label for="apt">Complemento</label>
                  <input type="text" name="apt" id="apt" placeholder="Digite o complemento">
                </div>
                <div class="input-group">
                  <label for="zip_code">CEP</label>
                  <input type="text" name="zip_code" id="zip_code" required placeholder="Digite o CEP">
                </div>
              </div>

              <div class="input-row">
                <div class="input-group">
                  <label for="district">Bairro</label>
                  <input type="text" name="district" id="district" required placeholder="Digite o bairro">
                </div>

                <div class="input-group">
                  <label for="city">Cidade</label>
                  <input type="text" name="city" id="city" required placeholder="Digite a cidade">
                </div>

                <div class="input-group">
                  <label for="uf">UF *</label>
                  <select id="uf" name="uf" required>
                    <option value="">Selecione</option>
                    <option value="AC">Acre</option>
                    <option value="AL">Alagoas</option>
                    <option value="AP">Amapá</option>
                    <option value="AM">Amazonas</option>
                    <option value="BA">Bahia</option>
                    <option value="CE">Ceará</option>
                    <option value="DF">Distrito Federal</option>
                    <option value="ES">Espírito Santo</option>
                    <option value="GO">Goiás</option>
                    <option value="MA">Maranhão</option>
                    <option value="MT">Mato Grosso</option>
                    <option value="MS">Mato Grosso do Sul</option>
                    <option value="MG">Minas Gerais</option>
                    <option value="PA">Pará</option>
                    <option value="PB">Paraíba</option>
                    <option value="PR">Paraná</option>
                    <option value="PE">Pernambuco</option>
                    <option value="PI">Piauí</option>
                    <option value="RJ">Rio de Janeiro</option>
                    <option value="RN">Rio Grande do Norte</option>
                    <option value="RS">Rio Grande do Sul</option>
                    <option value="RO">Rondônia</option>
                    <option value="RR">Roraima</option>
                    <option value="SC">Santa Catarina</option>
                    <option value="SP">São Paulo</option>
                    <option value="SE">Sergipe</option>
                    <option value="TO">Tocantins</option>
                  </select>
                </div>

                <div class="checkbox-group">
                  <input type="checkbox" name="principal_address" id="principal_address">
                  <label for="principal_address">Definir como endereço principal</label>
                </div>

                <div class="form-actions">
                  <button type="submit" class="btn-primary">Adicionar Endereço</button>
                </div>
              </div>

            </form>
          </div>

          <div id="addresses_container" class="settings-form-card">
            <h3>Meus Endereços</h3>
            {% if addresses %}
            {% for addr in addresses %}
            <div class="address-item">
              <p><strong>{{ addr.street_name }}, {{ addr.street_number }}</strong> {{ addr.apt or "" }}</p>
              <p>{{ addr.district }} - {{ addr.city }}/{{ addr.state }}</p>
              <p>CEP: {{ addr.zip_code }}</p>
              {% if addr.principal_address %}
              <p><span class="badge">Principal</span></p>
              {% endif %}

              <form action="/removeAddress/{{ addr.address_id }}" method="post" style="display:inline;">
                <button type="submit" class="btn-danger">Remover</button>
              </form>
            </div>
            {% endfor %}
            {% else %}
            <p>Você ainda não possui endereços cadastrados.</p>
            {% endif %}
          </div>

        </div>

        <div id="security" class="settings-section hidden-section">
          <h2>Segurança</h2>
          <p class="section-description">Altere seus dados relacionados à segurança.</p>
          <div class="settings-form-card">
            <form action="/auth/change" method="POST">
              <div class="input-group">
                <label for="email">Email</label>
                <input type="text" name="email" id="email" required placeholder="Digite seu email">
              </div>
              <button type="submit" class="btn-primary">Mudar Senha</button>
            </form>
          </div>
        </div>

        <div id="bidding" class="settings-section hidden-section">
          <h2>Meus Lances</h2>
          <div id="bids-container"></div>
        </div>

      </section>

    </div>
  </main>

  {% include 'components/Footer.html' %}
  <script>
    const email = "{{email}}";
    const defaultSection = "{{section}}";
  </script>
  <script src="{{ url_for('static', filename='js/mains/ConfigMain.js') }}"></script>
</body>

</html>